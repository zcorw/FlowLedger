# Flow-Ledger 个人资产管理系统 - 总体概览

## 1. 项目目标

Flow-Ledger 是一个全面的个人资产管理平台，帮助用户实现多币种资产的统一管理和财务分析。系统核心目标包括：

- **多币种资产管理**：支持用户记录和管理多种货币类型的资产
- **实时汇率跟踪**：自动记录和管理多币种间的汇率变化
- **全面财务记录**：详细记录用户的存款、消费、借贷等财务活动
- **用户友好体验**：通过 telegram bot 提供输入和查询，支持手动录入和自动计算

从用户视角，系统应提供一站式个人财务管理服务，让用户能够清晰掌握自己的财务状况。

## 2. 数据逻辑说明

### 系统架构概览：
Flow-Ledger 采用模块化设计，包含6个核心功能模块：

1. **货币管理模块**：系统基础，提供多币种支持和汇率服务
2. **用户管理模块**：身份认证和用户偏好管理，身份与telegram账户绑定
3. **存款管理模块**：多机构资产记录和统计
4. **消费管理模块**：日常支出记录和分析
5. **借贷管理模块**：个人和机构借贷关系管理
6. **定时通知任务模块**：定时提醒，用户确认后自动记账

### 核心数据关系：
- **用户为中心**：所有财务数据都关联到具体用户
- **货币统一**：所有金额字段都关联特定货币，通过汇率实现统一计算
- **时间序列**：支持历史数据查询
- **分类管理**：支持机构、消费类别、借贷对象等分类管理
- **统计汇总**：提供多维度数据统计和汇总功能

### 关键业务流程：
1. 用户注册 → 设置默认货币 → 录入初始资产
2. 日常消费记录 → 分类统计 → 消费分析
3. 资产变化记录 → 汇率更新 → 统一计算
4. 借贷关系管理 → 余额跟踪 → 风险分析

## 3. 核心业务规则（AI推理重点）

### 系统级规则：
1. **数据一致性规则**：确保各模块间数据的一致性和完整性
2. **多币种换算规则**：提供统一的货币换算服务，支持历史汇率查询
3. **用户权限规则**：确保用户只能访问和修改自己的数据
4. **时间序列规则**：支持历史数据查询和趋势分析
5. **统计汇总规则**：提供多维度数据统计和报表功能

### 跨模块集成规则：
6. **资产统一计算规则**：将存款、消费、借贷统一计算为用户净资产
7. **汇率自动更新规则**：系统自动获取和更新汇率数据
8. **数据同步规则**：确保相关模块间的数据同步更新
9. **报表生成规则**：提供综合财务报表和分析功能
10. **系统监控规则**：监控系统性能和数据质量

## 4. 输出要求

### 技术规范：
- **数据库**：PostgreSQL 12+
- **架构模式**：模块化设计，松耦合高内聚
- **资源类型**：存储过程、触发器、视图、函数
- **命名规范**：模块前缀 + 功能类型 + 具体功能
- **服务器**: Python + docker
- **前端架构**: telegram bot

### 模块间接口：
- **货币服务接口**：为其他模块提供货币换算和汇率查询服务
- **用户服务接口**：提供用户认证和权限验证服务
- **统计服务接口**：提供跨模块数据统计和汇总服务
- **通知与调度服务接口**：提供系统通知、定时任务创建/更新/暂停、提醒发送与确认回执（用于触发自动记账）

### 性能要求：
- 支持大量历史数据查询
- 提供高效的汇率换算服务
- 确保数据操作的原子性和一致性
- 支持并发用户访问

## 5. 风格与约束

### 系统级约束：
- **数据精度**：金额字段统一使用DECIMAL类型，确保计算精度
- **时间标准**：统一使用UTC时间，支持时区转换
- **字符编码**：支持UTF-8编码，兼容多语言
- **数据安全**：敏感信息加密存储，支持数据备份和恢复

### 开发规范：
- **代码风格**：统一的命名规范和注释风格
- **错误处理**：完善的错误处理和日志记录
- **测试覆盖**：全面的单元测试和集成测试
- **文档维护**：及时更新技术文档和用户手册

### 部署约束：
- **环境要求**：PostgreSQL 12+，支持Docker部署
- **监控要求**：系统性能监控和异常告警
- **备份策略**：定期数据备份和灾难恢复
- **安全要求**：数据加密传输和存储安全
